name: Auto update clash

on:  [push]
  
jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: update clash
      run: |
        wget -O clash 'https://convert.v2ray-subscribe.workers.dev/?url=https://raw.githubusercontent.com/sattheptonghop/sattheptonghop.github.io/main/v2ray&sni=dl.kgvn.garenanow.com&flag=clash'
    - name: edit clash
      run: |
        sed -i 's/select,/url-test,/g' clash
        sed -i 's|)"] }|)"], url: "http:\/\/www.gstatic.com\/generate_204", interval: 60}|g' clash
        sed -i 's/cipher: http/cipher: auto/g' clash
# Insert lines in file, then save.
#--------Begin here document-----------#
vi clash <<x23LimitStringx23
i
script:  
              code: |  
                def main(ctx, metadata):  
                  ip = metadata["dst_ip"]
                  if ip == "":  
                     ip = ctx.resolve_ip(metadata["host"])  
                  if ip == "":  
                    return "DIRECT"  

                  code = ctx.geoip(ip)  
                  if code == "LAN" or code == "CN" or code == "VN":  
                    return "DIRECT"  "

                  return "t.me/share_v2ray_file"
^[
ZZ
x23LimitStringx23
#----------End here document-----------#

#- name: copy clash1
    #  run: mkdir build && cp clash1 build
      
    - name: Commit files # transfer the new html files back into the repository
      run: |
        git config --global user.name "sattheptonghop"
        git add clash
        git commit -m "Update clash"
    - name: Push changes # push the output folder to your repo
      uses: ad-m/github-push-action@master
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        force: true
